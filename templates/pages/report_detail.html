{% extends 'base.html' %} 
{% block title %}Reporte #{{ report_id }} | WP Scrap{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<div class="breadcrumb">
  <a href="/">Dashboard</a>
  <span class="breadcrumb-separator">/</span>
  <a href="/domains">Dominios</a>
  <span class="breadcrumb-separator">/</span>
  <span>Reporte #{{ report_id }}</span>
</div>

<h1>📄 Reporte #{{ report_id }}</h1>
<p>Análisis completo del dominio en este momento específico</p>

<!-- Report Data -->
<div id="report-data-container" data-report-id="{{ report_id }}">
  <div class="loading">Cargando reporte...</div>
</div>

<!-- Actions -->

  <div class="btn-actions-wrapper">
    <div style="display: flex; gap: 12px; justify-content: center;">
      <a href="/domains" class="btn">← Volver a Dominios</a>
    </div>
  </div>

<!-- Trusted Contact Selection -->
<div class="card">
  <div class="card-header">
    <h2 style="margin: 0;">Contacto de confianza</h2>
  </div>
  <div class="card-body" id="trusted-contact-container">
    <div class="loading">Cargando contactos detectados...</div>
  </div>
</div>

<!-- IA Section -->
<div class="card">
  <div class="card-header">
    <h2 style="margin: 0;">Reporte generation - IA</h2>
  </div>
  <div class="gerenate-report-container">
    <button class="btn" type="button" data-report-type="technical">
      <p style="font-size: 32px;">🧑🏽‍💻</p>
      Generar reporte tecnico
    </button>
    <button class="btn" type="button" data-report-type="commercial">
      <p style="font-size: 32px;">📊</p>
      Generar reporte comercial
    </button>
    <button class="btn" type="button" data-report-type="deliverable">
      <p style="font-size: 32px;">📄</p>
      Generar reporte entregable
    </button>
  </div>
  <div id="report-ia-container">
    <!-- IA will be loaded here by JS -->
  </div>
  <div id="report-ia-history" class="ia-history">
    <!-- IA history will be injected by JS -->
  </div>
  <details id="report-ia-save" class="ia-save card card--embedded" data-ia-save>
    <summary class="ia-save__summary">
      <span class="ia-save__summary-label">Guardar versión IA</span>
      <span class="ia-save__summary-icon" aria-hidden="true">▼</span>
    </summary>
    <div class="ia-save__content" data-ia-save-content>
      <p class="ia-save__subtitle">Completa los campos y guarda la versión actual o una edición manual.</p>
      <div class="ia-save__form">
        <div class="ia-save__row">
          <label for="ia-save-type">Tipo de reporte</label>
          <select id="ia-save-type" class="form-control">
            <option value="technical">Técnico</option>
            <option value="commercial">Comercial</option>
            <option value="deliverable">Entregable</option>
          </select>
        </div>
        <div class="ia-save__row">
          <label for="ia-save-markdown">Markdown</label>
          <textarea id="ia-save-markdown" rows="8" placeholder="Pega o edita el Markdown a guardar..."></textarea>
          <small class="ia-save__help">Si generaste contenido, se cargará automáticamente aquí.</small>
        </div>
        <div class="ia-save__row">
          <label for="ia-save-tags">Tags (separados por coma)</label>
          <input id="ia-save-tags" type="text" placeholder="ej: resumen,cta,prioridad" />
        </div>
        <div class="ia-save__row">
          <label for="ia-save-metadata">Metadata (JSON)</label>
          <textarea id="ia-save-metadata" rows="4" placeholder="{ &quot;modelo&quot;: &quot;gpt-4&quot;, &quot;latencia_ms&quot;: 1200 }"></textarea>
          <small class="ia-save__help">Se validará que el contenido sea JSON válido antes de guardar.</small>
        </div>
      </div>
      <div class="ia-save__actions">
        <button type="button" class="btn btn-secondary" id="ia-save-reset">Limpiar campos</button>
        <button type="button" class="btn btn-primary" id="ia-save-submit">Guardar versión</button>
      </div>
    </div>
  </details>
</div>

<!-- Comments Section -->
<div class="card">
  <div id="report-comments-container">
    <!-- Comments will be loaded here by JS -->
  </div>
</div>


{% endblock %}

{% block extra_scripts %}
<script src="/static/js/pages/report_detail.js"></script>
<script>
  // Initialize report detail page
  $(function() {
    const reportContainer = document.getElementById('report-data-container');
    const reportIdAttr = reportContainer ? reportContainer.dataset.reportId : null;
    const parsedReportId = reportIdAttr ? Number(reportIdAttr) : null;

    if (parsedReportId && window.App && typeof window.App.initReportDetail === 'function') {
      window.App.initReportDetail(parsedReportId);
    }
  });
</script>
{% endblock %}
